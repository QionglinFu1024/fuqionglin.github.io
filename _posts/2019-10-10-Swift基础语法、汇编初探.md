---
layout: post
title: 'Swift5.0 (ä¸€)'
subtitle: 'åŸºç¡€è¯­æ³•ã€æ±‡ç¼–åˆæ¢'
date: 2019-10-10
categories: æŠ€æœ¯
cover: 
tags: Swift

---





### Swiftç‰ˆæœ¬

- å†æ—¶5å¹´å‘å±•ï¼Œä»Swift1.xå‘å±•åˆ°äº†Swift5.xç‰ˆæœ¬ï¼Œç»å†äº†å¤šæ¬¡é‡å¤§æ”¹å˜ï¼ŒABIç»ˆäºç¨³å®š
  - API(Application Programming Interface):åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£
    - æºä»£ç å’Œåº“ä¹‹é—´çš„æ¥å£ 
  - ABI(Application Binary Interface):åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£
    - åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„åº•å±‚æ¥å£

    - æ¶‰åŠçš„å†…å®¹æœ‰:ç›®æ ‡æ–‡ä»¶æ ¼å¼ã€æ•°æ®ç±»å‹çš„å¤§å°\å¸ƒå±€\å¯¹é½ã€å‡½æ•°è°ƒç”¨çº¦å®šç­‰ç­‰ 
- éšç€ABIçš„ç¨³å®šï¼ŒSwiftè¯­æ³•åŸºæœ¬ä¸ä¼šå†æœ‰å¤ªå¤§çš„å˜åŠ¨ï¼Œæ­¤æ—¶æ­£æ˜¯å­¦ä¹ Swiftçš„æœ€ä½³æ—¶åˆ»
- æˆªæ­¢è‡³2019å¹´6æœˆï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬:Swift5.1

- Swiftå®Œå…¨å¼€æº: https://github.com/apple/swiftï¼Œä¸»è¦é‡‡ç”¨C++ç¼–å†™ 
- swiftcå­˜æ”¾åœ¨Xcodeå†…éƒ¨ 
  - Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin 
- ä¸€äº›æ“ä½œ
  - ç”Ÿæˆè¯­æ³•æ ‘: swiftc -dump-ast main.swift 
  - ç”Ÿæˆæœ€ç®€æ´çš„SILä»£ç :swiftc -emit-sil main.swift 
  - ç”ŸæˆLLVM IRä»£ç : swiftc -emit-ir main.swift -o main.ll 
  - ç”Ÿæˆæ±‡ç¼–ä»£ç : swiftc -emit-assembly main.swift -o main.s 
- å¯¹æ±‡ç¼–ä»£ç è¿›è¡Œåˆ†æï¼Œå¯ä»¥çœŸæ­£æŒæ¡ç¼–ç¨‹è¯­è¨€çš„æœ¬è´¨
- ç¼–è¯‘æµç¨‹å¦‚ä¸‹ï¼š

![ç¼–è¯‘æµç¨‹](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000001.jpg)

---

### ç¨‹åºçš„æœ¬è´¨

- è½¯ä»¶\ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000002.jpg)

---

### å¯„å­˜å™¨ä¸å†…å­˜

- é€šå¸¸ï¼ŒCPUä¼šå…ˆå°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†å¯¹å¯„å­˜å™¨ä¸­çš„æ•°æ®è¿›è¡Œè¿ç®—

- å‡è®¾å†…å­˜ä¸­æœ‰å—çº¢è‰²å†…å­˜ç©ºé—´çš„å€¼æ˜¯3ï¼Œç°åœ¨æƒ³æŠŠå®ƒçš„å€¼åŠ 1ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°è“è‰²å†…å­˜ç©ºé—´ 

  - CPUé¦–å…ˆä¼šå°†çº¢è‰²å†…å­˜ç©ºé—´çš„å€¼æ”¾åˆ°raxå¯„å­˜å™¨ä¸­:`movq çº¢è‰²å†…å­˜ç©ºé—´, %rax` 
  - ç„¶åè®©raxå¯„å­˜å™¨ä¸1ç›¸åŠ :`addq $0x1, %rax`
  - æœ€åå°†å€¼èµ‹å€¼ç»™å†…å­˜ç©ºé—´:`movq %rax, è“è‰²å†…å­˜ç©ºé—´` 

  ![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000003.jpg)

---

### ç¼–ç¨‹è¯­è¨€çš„å‘å±•

-  æœºå™¨è¯­è¨€ 
  - ç”±0å’Œ1ç»„æˆ 
- æ±‡ç¼–è¯­è¨€(Assembly Language)
  - ç”¨ç¬¦å·ä»£æ›¿äº†0å’Œ1ï¼Œæ¯”æœºå™¨è¯­è¨€ä¾¿äºé˜…è¯»å’Œè®°å¿† 
- é«˜çº§è¯­è¨€
  -  C\C++\Java\JavaScript\Pythonç­‰ï¼Œæ›´æ¥è¿‘äººç±»è‡ªç„¶è¯­è¨€ 
- æ“ä½œ:å°†å¯„å­˜å™¨BXçš„å†…å®¹é€å…¥å¯„å­˜å™¨AX 
  - æœºå™¨è¯­è¨€:1000100111011000
  -  æ±‡ç¼–è¯­è¨€:movw %bx, %ax
  -  é«˜çº§è¯­è¨€:ax = bx;

---

### ç¼–ç¨‹è¯­è¨€çš„å‘å±•

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000004.jpg)

- **æ±‡ç¼–è¯­è¨€**ä¸**æœºå™¨è¯­è¨€**ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸€æ¡æœºå™¨æŒ‡ä»¤éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤
- **æ±‡ç¼–è¯­è¨€**å¯ä»¥é€šè¿‡ç¼–è¯‘å¾—åˆ°**æœºå™¨è¯­è¨€**ï¼Œ**æœºå™¨è¯­è¨€**å¯ä»¥é€šè¿‡åæ±‡ç¼–å¾—åˆ°**æ±‡ç¼–è¯­è¨€**
- **é«˜çº§è¯­è¨€**å¯ä»¥é€šè¿‡ç¼–è¯‘å¾—åˆ°**æ±‡ç¼–è¯­è¨€** \ **æœºå™¨è¯­è¨€**ï¼Œä½†**æ±‡ç¼–è¯­è¨€** \ **æœºå™¨è¯­è¨€**å‡ ä¹ä¸å¯èƒ½è¿˜åŸæˆ**é«˜çº§è¯­è¨€**

---

### æ±‡ç¼–è¯­è¨€çš„ç§ç±»

-  æ±‡ç¼–è¯­è¨€çš„ç§ç±» 

  - 8086æ±‡ç¼–(16bit) 

  - x86æ±‡ç¼–(32bit) 

  - x64æ±‡ç¼–(64bit) 

  - ARMæ±‡ç¼–(åµŒå…¥å¼ã€ç§»åŠ¨è®¾å¤‡) 

  - ...... 

    

- x86ã€x64æ±‡ç¼–æ ¹æ®ç¼–è¯‘å™¨çš„ä¸åŒï¼Œæœ‰2ç§ä¹¦å†™æ ¼å¼ 

  - Intel:Windowsæ´¾ç³»
  - AT&T :Unixæ´¾ç³» 

  

- ä½œä¸ºiOSå¼€å‘å·¥ç¨‹å¸ˆï¼Œæœ€ä¸»è¦çš„æ±‡ç¼–è¯­è¨€æ˜¯ 

  - AT&Tæ±‡ç¼– -> iOSæ¨¡æ‹Ÿå™¨
  - ARMæ±‡ç¼– -> iOSçœŸæœºè®¾å¤‡

---

### å¸¸è§æ±‡ç¼–æŒ‡ä»¤

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000006.jpg)

---

### å¯„å­˜å™¨

- æœ‰16ä¸ªå¸¸ç”¨å¯„å­˜å™¨

  - raxã€rbxã€rcx ã€rdxã€rsiã€rdiã€rbpã€rsp 

  - r8ã€r9ã€r10ã€r11ã€r12ã€r13ã€r14ã€r15 

    

- å¯„å­˜å™¨çš„å…·ä½“ç”¨é€”

  - raxã€rdxå¸¸ä½œä¸ºå‡½æ•°è¿”å›å€¼ä½¿ç”¨ 
  - rdiã€rsiã€rdxã€rcxã€r8ã€r9ç­‰å¯„å­˜å™¨å¸¸ç”¨äºå­˜æ”¾å‡½æ•°å‚æ•° 
  - rspã€rbpç”¨äºæ ˆæ“ä½œ
  - ripä½œä¸ºæŒ‡ä»¤æŒ‡é’ˆ
    - å­˜å‚¨ç€CPUä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€
    - ä¸€æ—¦CPUè¯»å–ä¸€æ¡æŒ‡ä»¤ï¼Œripä¼šè‡ªåŠ¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤(å­˜å‚¨ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€)

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000005.jpg)

---



### lldbå¸¸ç”¨æŒ‡ä»¤

- è¯»å–å¯„å­˜å™¨çš„å€¼ 

  - register read/æ ¼å¼ 

  - register read/x 

    

- ä¿®æ”¹å¯„å­˜å™¨çš„å€¼

  - register write å¯„å­˜å™¨åç§° æ•°å€¼ 

  - register write rax 0 

    

- è¯»å–å†…å­˜ä¸­çš„å€¼ 

  - x/æ•°é‡-æ ¼å¼-å­—èŠ‚å¤§å° å†…å­˜åœ°å€ 

  - x/3xw 0x0000010 

    

- ä¿®æ”¹å†…å­˜ä¸­çš„å€¼

  - memory write å†…å­˜åœ°å€ æ•°å€¼ 

  - memory write 0x0000010 10

    

- æ ¼å¼ 

  - xæ˜¯16è¿›åˆ¶ï¼Œfæ˜¯æµ®ç‚¹ï¼Œdæ˜¯åè¿›åˆ¶ 

    

- å­—èŠ‚å¤§å°

  - b â€“ byte 1å­—èŠ‚

  - h â€“ half word 2å­—èŠ‚ 

  - w â€“ word 4å­—èŠ‚

  - g â€“ giant word 8å­—èŠ‚ 

    

-  expression è¡¨è¾¾å¼ 

  - å¯ä»¥ç®€å†™:expr è¡¨è¾¾å¼ 

  - expression $rax 

  - expression $rax = 1 

    

- po è¡¨è¾¾å¼ 

- print è¡¨è¾¾å¼ 

  - po/x $rax 
  - po (int)$rax

- thread step-overã€nextã€n 

  - å•æ­¥è¿â¾ï¼ŒæŠŠå­å‡½æ•°å½“åšæ•´ä½“â¼€ä¸€æ­¥æ‰§ï¨ˆ(æºç çº§åˆ«) 

    

- thread step-inã€stepã€s 

  - å•æ­¥è¿â¾ï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°(æºç çº§åˆ«) 

    

- thread step-inst-overã€nextiã€ni 

  - å•æ­¥è¿ï¨ˆï¼ŒæŠŠå­å‡½æ•°å½“åšæ•´ä½“â¼€ä¸€æ­¥æ‰§ï¨ˆ(æ±‡ç¼–çº§åˆ«) 

    

- thread step-instã€stepiã€si 
  - å•æ­¥è¿â¾ï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°(æ±‡ç¼–çº§åˆ«) 

- thread step-outã€finish 
  - ç›´æ¥æ‰§â¾å®Œå½“å‰å‡½æ•°çš„æ‰€æœ‰ä»£ç ï¼Œè¿”å›åˆ°ä¸Šä¸€ä¸ªå‡½æ•°(é‡åˆ°æ–­ç‚¹ä¼šå¡ä½)

---

### è§„å¾‹

- å†…å­˜åœ°å€æ ¼å¼ä¸º:`0x4bdc(%rip)`ï¼Œä¸€èˆ¬æ˜¯å…¨å±€å˜é‡ï¼Œå…¨å±€åŒº(æ•°æ®æ®µ) 

-  å†…å­˜åœ°å€æ ¼å¼ä¸º:`-0x78(%rbp)`ï¼Œä¸€èˆ¬æ˜¯å±€éƒ¨å˜é‡ï¼Œæ ˆç©ºé—´

-  å†…å­˜åœ°å€æ ¼å¼ä¸º:`0x10(%rax)`ï¼Œä¸€èˆ¬æ˜¯å †ç©ºé—´

  ---

## åŸºç¡€è¯­æ³•

### Hello World

- ä¸ç”¨ç¼–å†™mainå‡½æ•°ï¼ŒSwiftå°†å…¨å±€èŒƒå›´å†…çš„é¦–å¥å¯æ‰§è¡Œä»£ç ä½œä¸ºç¨‹åºå…¥å£
- ä¸€å¥ä»£ç å°¾éƒ¨å¯ä»¥çœç•¥åˆ†å·(;)ï¼Œå¤šå¥ä»£ç å†™åˆ°åŒä¸€è¡Œæ—¶å¿…é¡»ç”¨åˆ†å·(;)éš”å¼€ 
- ç”¨varå®šä¹‰å˜é‡ï¼Œletå®šä¹‰å¸¸é‡ï¼Œç¼–è¯‘å™¨èƒ½è‡ªåŠ¨æ¨æ–­å‡ºå˜é‡\å¸¸é‡çš„ç±»å‹ 
-  Playgroundå¯ä»¥å¿«é€Ÿé¢„è§ˆä»£ç æ•ˆæœï¼Œæ˜¯å­¦ä¹ è¯­æ³•çš„å¥½å¸®æ‰‹ 
  - Command + Shift + Enter:è¿è¡Œæ•´ä¸ªPlayground 
  - Shift + Enter:è¿è¡Œæˆªæ­¢åˆ°æŸä¸€è¡Œä»£ç  

---

### Playground - View

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000007.jpg)

---

### Playground - ViewController

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000008.jpg)

---

### Playground â€“ å¤šPage

![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000009.jpg)

---

### æ³¨é‡Š

- Playgroundçš„æ³¨é‡Šæ”¯æŒmarkupè¯­æ³•(ä¸markdownç›¸ä¼¼) 
- å¼€å¯markupæ¸²æŸ“æ•ˆæœ:Editor -> Show Rendered Markup 
- æ³¨æ„:Markupåªåœ¨Playgroundä¸­æœ‰æ•ˆ

```objective-c
//å•è¡Œæ³¨é‡Š

/*
 å¤šè¡Œæ³¨é‡Š
 */

/*
 1
 /* å¤šè¡Œæ³¨é‡Šçš„åµŒå¥— */
 2
*/

//: å¼€å§‹markup

/* :
 å¼€å§‹markup
 */
```

---

### å¸¸é‡

-  åªèƒ½èµ‹å€¼1æ¬¡

-  å®ƒçš„å€¼ä¸è¦æ±‚åœ¨ç¼–è¯‘æ—¶æœŸç¡®å®šï¼Œä½†ä½¿ç”¨ä¹‹å‰å¿…é¡»èµ‹å€¼1æ¬¡ 

  ![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000010.jpg)

- ä¸‹é¢ä»£ç æ˜¯é”™è¯¯çš„ 

  ![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000012.jpg)

- å¸¸é‡ã€å˜é‡åœ¨åˆå§‹åŒ–ä¹‹å‰ï¼Œéƒ½ä¸èƒ½ä½¿ç”¨ 

  ![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000011.jpg)

---

### æ ‡è¯†ç¬¦

- æ ‡è¯†ç¬¦(æ¯”å¦‚å¸¸é‡åã€å˜é‡åã€å‡½æ•°å)å‡ ä¹å¯ä»¥ä½¿ç”¨ä»»ä½•å­—ç¬¦

-  æ ‡è¯†ç¬¦ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œä¸èƒ½åŒ…å«ç©ºç™½å­—ç¬¦ã€åˆ¶è¡¨ç¬¦ã€ç®­å¤´ç­‰ç‰¹æ®Šå­—ç¬¦ 

  ![](https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000013.jpg)

---

### å¸¸è§æ•°æ®ç±»å‹

|    å€¼ç±»å‹(value type)    |   æšä¸¾(enum)   |              Optional               |
| :----------------------: | :------------: | :---------------------------------: |
|                          | ç»“æ„ä½“(struct) | Boolã€Intã€Floatã€Doubleã€Character |
|                          |                |   Stringã€Arrayã€Dictionaryã€Set    |
| å¼•ç”¨ç±»å‹(reference type) |   ç±»(class)    |                                     |

- æ•´æ•°ç±»å‹:Int8ã€Int16ã€Int32ã€Int64ã€UInt8ã€UInt16ã€UInt32ã€UInt64 
-  åœ¨32bitå¹³å°ï¼ŒIntç­‰ä»·äºInt32;åœ¨64bitå¹³å°ï¼Œ Intç­‰ä»·äºInt64

- æ•´æ•°çš„æœ€å€¼:UInt8.maxã€Int16.min

- ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç›´æ¥ä½¿ç”¨Intå³å¯ 
-  æµ®ç‚¹ç±»å‹:Floatï¼Œ32ä½ï¼Œç²¾åº¦åªæœ‰6ä½;Doubleï¼Œ64ä½ï¼Œç²¾åº¦è‡³å°‘15ä½

---

### å­—é¢é‡

- æ•´æ•°å’Œæµ®ç‚¹æ•°å¯ä»¥æ·»åŠ é¢å¤–çš„é›¶æˆ–è€…æ·»åŠ ä¸‹åˆ’çº¿æ¥å¢å¼ºå¯è¯»æ€§
  - 100_1000ã€1_000_000.000_000_1ã€ 000123.456 

```objective-c
//å­—ç¬¦ä¸²
let string = "ç†Šç†Šç†Š"

//å­—ç¬¦ï¼ˆå¯å­˜å‚¨ASCIIå­—ç¬¦ã€Unicodeå­—ç¬¦ï¼‰
let character: Character = "ğŸ¶"

//å¸ƒå°”
let bool = true //å–åæ˜¯false

//æ•´æ•°
let intDecimal = 17 //åè¿›åˆ¶
let intBinary = 17 //äºŒè¿›åˆ¶
let intOctal = 17 //å…«è¿›åˆ¶
let intHexadecimal = 17 //åå…­è¿›åˆ¶

//æµ®ç‚¹æ•°
let doubleDecimal = 125.0 //åè¿›åˆ¶ï¼Œç­‰ä»·äº1.25e2ï¼Œ0.0125ç­‰ä»·äº1.25e-2
let doubleHexadecimal1 = 0xFp2 //åå…­è¿›åˆ¶ï¼Œæ„å‘³ç€15x2^2ï¼Œç›¸å½“äºåè¿›åˆ¶çš„60.0
let doubleHexadecimal2 = 0xFp-2 //åå…­è¿›åˆ¶ï¼Œæ„å‘³ç€15x2^-2ï¼Œç›¸å½“äºåè¿›åˆ¶çš„3.75

//æ•°ç»„
let array = [1, 3, 5, 7, 9]

//å­—å…¸
let dictionary = ["age" : 18, "height" : 168, "weight" : 120]
```

---

### ç±»å‹è½¬æ¢

```objective-c
//æ•´æ•°è½¬æ¢
let int1: UInt16 = 2_000
let int2: UInt8 = 1
let int3 = int1 + UInt16(int2)

//æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢
let int = 3
let double = 0.14159
let pi = Double(int) + double
let intPi = Int(pi)
```

---

### å…ƒç¥–

```objective-c
let http404Error = (404, "Not Found")
print("The status code is \(http404Error.0)")

let (statusCode, statusMessage) = http404Error
print("The status code is \(statusCode)")

let (justTheStatusCode, _) = http404Error

let http200Status = (statusCode: 200, description: "OK")
print("The status code is \(http200Status.statusCode)")
```


I"ï½<h3 id="aes-128-cbc">AES-128-CBC</h3>

<p>è¿™é‡Œé¦–å…ˆè¯´è¯´AESåŠ å¯†åŸç†
AESåŠ å¯†ç®—æ³•é‡‡ç”¨åˆ†ç»„å¯†ç ä½“åˆ¶ï¼Œæ¯ä¸ªåˆ†ç»„æ•°æ®çš„é•¿åº¦ä¸º128ä½16ä¸ªå­—èŠ‚ï¼Œå¯†é’¥é•¿åº¦å¯ä»¥æ˜¯128ä½16ä¸ªå­—èŠ‚ã€192ä½æˆ–256ä½ï¼Œä¸€å…±æœ‰å››ç§åŠ å¯†æ¨¡å¼ï¼ˆECBã€CBCã€CFBã€OFBï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨éœ€è¦åˆå§‹å‘é‡IVçš„CBCæ¨¡å¼ï¼Œåˆå§‹å‘é‡çš„é•¿åº¦è§„å®šæ˜¯128ä½16ä¸ªå­—èŠ‚ã€‚å¦å¤–å°±æ˜¯Paddingï¼Œè¿™é‡Œé¢æœ‰å¤§å‘ã€‚ã€‚ã€‚ã€‚å…ˆè¯´ä¸€ä¸‹Paddingçš„ä¸‰ç§æ¨¡å¼PKCS5ã€PKCS7å’ŒNOPADDINGã€‚PKCS5æ˜¯æŒ‡åˆ†ç»„æ•°æ®ç¼ºå°‘å‡ ä¸ªå­—èŠ‚ï¼Œå°±åœ¨æ•°æ®çš„æœ«å°¾å¡«å……å‡ ä¸ªå­—èŠ‚çš„å‡ ï¼Œæ¯”å¦‚ç¼ºå°‘5ä¸ªå­—èŠ‚ï¼Œå°±åœ¨æœ«å°¾å¡«å……5ä¸ªå­—èŠ‚çš„5ã€‚PKCS7æ˜¯æŒ‡åˆ†ç»„æ•°æ®ç¼ºå°‘å‡ ä¸ªå­—èŠ‚ï¼Œå°±åœ¨æ•°æ®çš„æœ«å°¾å¡«å……å‡ ä¸ªå­—èŠ‚çš„0ï¼Œæ¯”å¦‚ç¼ºå°‘7ä¸ªå­—èŠ‚ï¼Œå°±åœ¨æœ«å°¾å¡«å……7ä¸ªå­—èŠ‚çš„0ã€‚NoPaddingæ˜¯æŒ‡ä¸éœ€è¦å¡«å……ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®çš„å‘é€æ–¹è‚¯å®šä¼šä¿è¯æœ€åä¸€æ®µæ•°æ®ä¹Ÿæ­£å¥½æ˜¯16ä¸ªå­—èŠ‚ã€‚è€ŒPKCS5å¦‚æœæ­£å¥½æ˜¯16ä¸ªå­—èŠ‚ä¸”æœ€åæ˜¯16çš„æ—¶å€™åˆ™ä¼šå†å¡«å……16ä¸ª16ç”¨æ¥åŒºåˆ†ï¼ŒPKC7åˆ™æ˜¯ä¸º0æ—¶å¡«å……16ä¸ª0ã€‚è€Œåœ¨iOSçš„OCæ–¹æ³•é‡Œå‹æ ¹æ²¡æä¾›PKCS5ï¼Œåªæœ‰PKCS7æ›´å‘çš„æ˜¯çœŸæ­£å¯¹æ¥æ—¶å‘ç°iOSä¸Šçš„PKCS7å’Œå…¶ä»–ç«¯PKCS5æ˜¯ä¸€æ ·çš„ã€‚ã€‚ã€‚ã€‚æ‰€ä»¥æ‰æœ‰äº†ç°åœ¨çš„æƒ³æ³•åˆ†äº«ä¸€ä¸‹è¸©è¿‡çš„å‘ï¼Œå…·ä½“å•¥åŸå› ææ€•åªæœ‰è‹¹æœè‡ªå®¶çŸ¥é“ï¼Œç³»ç»Ÿæ–¹æ³•æ˜¯çœŸçš„å‘ï¼Javaå¯ä»¥ç›´æ¥ç”¨ç³»ç»Ÿæ–¹æ³•å¡«å¥½è®¾ç½®ç»“æŸæˆ˜æ–—ã€‚ã€‚ã€‚Goçš„è¯paddingè¿™å—è‡ªå·±å†™å®ç°å…¶ä»–çš„ç³»ç»Ÿéƒ½èƒ½è®¾ç½®ã€‚æœ€åè¯´ä¸€ä¸‹å¯†é’¥é•¿åº¦è¿™é‡Œåªæœ‰iOSæ˜¯è¦è‡ªå·±è®¾ç½®å¥½ä½æ•°å†å¯¹åº”ä½æ•°å†™å¯†é’¥ï¼Œå…¶ä»–å¹³å°ç›´æ¥å¯¹åº”ä½æ•°å†™å¯†é’¥å³å¯ï¼Œæ‰€ä»¥æœ€å¥½å„å¹³å°è‡ªå·±åœ¨å°è£…ä¸‹åˆ¤æ–­å¯†é’¥é•¿åº¦å‡ºäº‹å‘é‡é•¿åº¦ï¼Œä¸ç„¶å„ç«¯å¯¹åº”èµ·æ¥è¿˜æ˜¯è¦çŠ¯å‚»ã€‚</p>

<h3 id="base64">Base64</h3>

<p>ä¸‹é¢è¯´ä¸€ä¸‹Base64ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸ªå‘ï¼ŒiOSç³»ç»Ÿæä¾›çš„base64å¯é€‰ç±»å‹å‹æ ¹å°±ä¸æ˜¯å·²çŸ¥é¢†åŸŸå¸¸ç”¨çš„ï¼Œæ­£å¸¸æ˜¯paddingå’Œwebsafeï¼Œpaddingä¼šå¡«å……=ï¼Œè€Œwebsafeåˆ™ä¼šæ›¿æ¢â€+â€ä¸ºâ€-â€œï¼Œâ€"ä¸ºâ€_â€
è€ŒiOSæä¾›çš„åˆ™æ˜¯ä¸‹è¾¹çš„ï¼Œå®Œå…¨ä¸å¸¸ç”¨çš„ã€‚ã€‚ã€‚</p>

<pre><code class="language-objective-c">NSDataBase64Encoding64CharacterLineLength      å…¶ä½œç”¨æ˜¯å°†ç”Ÿæˆçš„Base64å­—ç¬¦ä¸²æŒ‰ç…§64ä¸ªå­—ç¬¦é•¿åº¦è¿›è¡Œç­‰åˆ†æ¢è¡Œã€‚  
NSDataBase64Encoding76CharacterLineLength      å…¶ä½œç”¨æ˜¯å°†ç”Ÿæˆçš„Base64å­—ç¬¦ä¸²æŒ‰ç…§76ä¸ªå­—ç¬¦é•¿åº¦è¿›è¡Œç­‰åˆ†æ¢è¡Œã€‚  
NSDataBase64EncodingEndLineWithCarriageReturn  å…¶ä½œç”¨æ˜¯å°†ç”Ÿæˆçš„Base64å­—ç¬¦ä¸²ä»¥å›è½¦ç»“æŸã€‚  
NSDataBase64EncodingEndLineWithLineFeed        å…¶ä½œç”¨æ˜¯å°†ç”Ÿæˆçš„Base64å­—ç¬¦ä¸²ä»¥æ¢è¡Œç»“æŸã€‚  
</code></pre>

<p>åŸºæœ¬ä¸ŠGTMBase64ç”¨å®šäº†ï¼Œç„¶åè¿˜è¦æ‰©å±•ä¸€ä¸‹paddingè®¾ç½®ï¼ŒåŸç‰ˆåªæ˜¯æŠŠwebsafeæ¨¡å¼å¼€æ”¾äº†paddingè®¾ç½®ï¼Œå†…éƒ¨å…¶å®æœ‰å¯¹åº”é€»è¾‘åªéœ€è¦è‡ªå·±åŠ ä¸ªæ–¹æ³•è°ƒç”¨ä¸€ä¸‹å³å¯ã€‚ä¸‹é¢å°±æ˜¯æ·»åŠ çš„å’Œå¾®æ”¹çš„ä¸¤ä¸ªæ–¹æ³•</p>

<pre><code class="language-objective-c">+(NSString *)gm_stringByEncodingData:(NSData *)data padded:(BOOL)padded{
    NSString *result = nil;
    NSData *converted = [self baseEncode:[data bytes]
                                  length:[data length]
                                 charset:kBase64EncodeChars
                                  padded:padded];
    if (converted) {
        result = [[NSString alloc] initWithData:converted
                                        encoding:NSUTF8StringEncoding];
    }
    return result;
}

+(NSData *)gm_decodeString:(NSString *)string {
    NSData *result = nil;
    NSData *data = [string dataUsingEncoding:NSUTF8StringEncoding];
    if (data) {
        result = [self baseDecode:[data bytes]
                           length:[data length]
                          charset:kBase64DecodeChars
                   requirePadding:NO];
    }
    return result;
}
</code></pre>

<p>è‡³äºJavaï¼Œandroidå¼€å‘å¾ˆçˆ½ç›´æ¥ç”¨android.util.base64,é‡Œé¢ç›´æ¥å¯ä»¥è®¾ç½®nopaddingå’Œwebsafeç­‰ï¼Œè€Œçº¯Javaç”¨java.util.base64å°±è¦è‡ªå·±å†™æ›¿æ¢é€»è¾‘ï¼Œå…·ä½“ä»£ç è§æºç éƒ¨åˆ†
æœ€åè¯´ä¸€ä¸‹Goç›´æ¥ç³»ç»Ÿæ–¹æ³•æä¾›å®Œç¾è§£å†³</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">base64</span><span class="o">.</span><span class="na">StdEncoding</span>
<span class="n">base64</span><span class="o">.</span><span class="na">URLEncoding</span>        <span class="n">websafeæ¨¡å¼</span>
<span class="n">base64</span><span class="o">.</span><span class="na">RawStdEncoding</span>    <span class="n">nopadding</span>
<span class="n">base64</span><span class="o">.</span><span class="na">RawURLEncoding</span>    <span class="n">websafeæ¨¡å¼nopadding</span>
</code></pre></div></div>

<h3 id="aes-128-cbc-base64-nopaddingæºç ">AES-128-CBC +Base64-Nopaddingæºç </h3>

<p>ä¸‹é¢å°±æ˜¯3ä¸­è¯­è¨€åˆ†åˆ«å®ç° AES-128-CBC +Base64-Nopaddingï¼Œä»ç¼–ç ä½“éªŒå’Œå¯¹åº”ä¸Šå¾ˆæ˜æ˜¾Javaæœ€æ¸…æ™°ï¼ŒGoè¦è‡ªå·±å†™ç‚¹ä¸œè¥¿ï¼ŒOCåˆ™æ˜¯è¿å¯¹åº”å¯¹å’Œæ­£å¸¸ç†è§£èŒƒå›´å†…æœ‰åå·®ã€‚</p>

<h2 id="oc">OC</h2>

<pre><code class="language-objective-c">#import "GMAESUtil.h"
#import &lt;CommonCrypto/CommonCrypto.h&gt;
#import "GTMBase64.h"

@implementation NSData (Encryption)

//(keyå’Œivå‘é‡è¿™é‡Œæ˜¯16ä½çš„) è¿™é‡Œæ˜¯CBCåŠ å¯†æ¨¡å¼ï¼Œå®‰å…¨æ€§æ›´é«˜
- (NSData *)AES128EncryptWithKey:(NSString *)key Iv:(NSString *)Iv {//åŠ å¯†
    // 'key' should be 32 bytes for AES128, will be null-padded otherwise
    char keyPtr[kCCKeySizeAES128 + 1]; // room for terminator (unused)
    bzero(keyPtr, sizeof(keyPtr)); // fill with zeroes (for padding)

    // fetch key data
    [key getCString:keyPtr maxLength:sizeof(keyPtr) encoding:NSUTF8StringEncoding];

    char ivPtr[kCCKeySizeAES128 + 1];
    memset(ivPtr, 0, sizeof(ivPtr));
    [Iv getCString:ivPtr maxLength:sizeof(ivPtr) encoding:NSUTF8StringEncoding];

    NSUInteger dataLength = [self length];

    //See the doc: For block ciphers, the output size will always be less than or
    //equal to the input size plus the size of one block.
    //That's why we need to add the size of one block here
    size_t bufferSize = dataLength + kCCBlockSizeAES128;
    void *buffer = malloc(bufferSize);

    size_t numBytesEncrypted = 0;
    CCCryptorStatus cryptStatus = CCCrypt(kCCEncrypt, kCCAlgorithmAES128, kCCOptionPKCS7Padding,
                                          keyPtr, kCCKeySizeAES128,
                                          ivPtr /* initialization vector (optional) */,
                                          [self bytes], dataLength, /* input */
                                          buffer, bufferSize, /* output */
                                          &amp;numBytesEncrypted);
    if (cryptStatus == kCCSuccess) {
        //the returned NSData takes ownership of the buffer and will free it on deallocation
        return [NSData dataWithBytesNoCopy:buffer length:numBytesEncrypted];
    }

    free(buffer); //free the buffer;
    return nil;
}

- (NSData *)AES128DecryptWithKey:(NSString *)key Iv:(NSString *)Iv {//è§£å¯†
    char keyPtr[kCCKeySizeAES128 + 1]; // room for terminator (unused)
    bzero(keyPtr, sizeof(keyPtr)); // fill with zeroes (for padding)

    // fetch key data
    [key getCString:keyPtr maxLength:sizeof(keyPtr) encoding:NSUTF8StringEncoding];

    char ivPtr[kCCKeySizeAES128 + 1];
    memset(ivPtr, 0, sizeof(ivPtr));
    [Iv getCString:ivPtr maxLength:sizeof(ivPtr) encoding:NSUTF8StringEncoding];

    NSUInteger dataLength = [self length];

    //See the doc: For block ciphers, the output size will always be less than or
    //equal to the input size plus the size of one block.
    //That's why we need to add the size of one block here
    size_t bufferSize = dataLength + kCCBlockSizeAES128;
    void *buffer = malloc(bufferSize);

    size_t numBytesDecrypted = 0;
    CCCryptorStatus cryptStatus = CCCrypt(kCCDecrypt, kCCAlgorithmAES128, kCCOptionPKCS7Padding,
                                          keyPtr, kCCKeySizeAES128,
                                          ivPtr /* initialization vector (optional) */,
                                          [self bytes], dataLength, /* input */
                                          buffer, bufferSize, /* output */
                                          &amp;numBytesDecrypted);

    if (cryptStatus == kCCSuccess) {
        //the returned NSData takes ownership of the buffer and will free it on deallocation
        return [NSData dataWithBytesNoCopy:buffer length:numBytesDecrypted];
    }

    free(buffer); //free the buffer;
    return nil;
}

@end

@implementation GMAESUtil

#pragma mark - AESåŠ å¯†
static NSString * ivParameter = @"1234567890123456";

//å°†stringè½¬æˆå¸¦å¯†ç çš„data
+ (NSString *)gm_encryptAESString:(NSString *)string key:(NSString *)key
{
    //å°†nsstringè½¬åŒ–ä¸ºnsdata
    NSData *data = [string dataUsingEncoding:NSUTF8StringEncoding];
    //ä½¿ç”¨å¯†ç å¯¹nsdataè¿›è¡ŒåŠ å¯†
    NSData *encryptedData = [data AES128EncryptWithKey:key Iv:ivParameter];
    NSString *encryptedString = [GTMBase64 gm_stringByEncodingData:encryptedData padded:NO];
    return encryptedString;
}

+ (NSString *)gm_decryptAESString:(NSString *)string key:(NSString *)key
{
    //å°†nsstringè½¬åŒ–ä¸ºnsdata
    NSData *data = [GTMBase64 gm_decodeString:string];
    NSData *decryptData = [data AES128DecryptWithKey:key Iv:ivParameter];
    NSString *str = [[NSString alloc] initWithData:decryptData encoding:NSUTF8StringEncoding];
    return str;
}

@end
</code></pre>

<h2 id="java">Java</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.IvParameterSpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Base64</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityCore</span> <span class="o">{</span>
    <span class="cm">/*
     * åŠ å¯†ç”¨çš„Key å¯ä»¥ç”¨26ä¸ªå­—æ¯å’Œæ•°å­—ç»„æˆ æ­¤å¤„ä½¿ç”¨AES-128-CBCåŠ å¯†æ¨¡å¼ï¼Œkeyéœ€è¦ä¸º16ä½ã€‚
     */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">sKey</span>        <span class="o">=</span> <span class="s">"dde4b1f8a9e6b814"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ivParameter</span> <span class="o">=</span> <span class="s">"dde4b1f8a9e6b814"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">SecurityCore</span> <span class="n">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">SecurityCore</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SecurityCore</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecurityCore</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">webSafeBase64StringEncoding</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">sSrc</span><span class="o">,</span><span class="kt">boolean</span> <span class="n">padded</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">encodeString</span><span class="o">=</span><span class="nc">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">().</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">sSrc</span><span class="o">);</span><span class="c1">// æ­¤å¤„ä½¿ç”¨BASE64åšè½¬ç ã€‚</span>

        <span class="c1">//websafe base64</span>
        <span class="n">encodeString</span><span class="o">=</span><span class="n">encodeString</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">"+"</span><span class="o">,</span><span class="s">"-"</span><span class="o">);</span>
        <span class="n">encodeString</span><span class="o">=</span><span class="n">encodeString</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span><span class="s">"_"</span><span class="o">);</span>

        <span class="c1">//nopadding base64</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">padded</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"="</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">encodeString</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"="</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">encodeString</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">encodeString</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">webSafeBase64StringDecoding</span><span class="o">(</span><span class="nc">String</span> <span class="n">sSrc</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">//websafe base64</span>
        <span class="n">sSrc</span><span class="o">=</span><span class="n">sSrc</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span><span class="s">"+"</span><span class="o">);</span>
        <span class="n">sSrc</span><span class="o">=</span><span class="n">sSrc</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">"_"</span><span class="o">,</span><span class="s">"/"</span><span class="o">);</span>

        <span class="k">return</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">().</span><span class="na">decode</span><span class="o">(</span><span class="n">sSrc</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">base64StringEncoding</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">sSrc</span><span class="o">,</span><span class="kt">boolean</span> <span class="n">padded</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">encodeString</span><span class="o">=</span><span class="nc">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">().</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">sSrc</span><span class="o">);</span><span class="c1">// æ­¤å¤„ä½¿ç”¨BASE64åšè½¬ç ã€‚</span>

        <span class="c1">//nopadding base64</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">padded</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"="</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">encodeString</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"="</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">encodeString</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">encodeString</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">base64StringDecoding</span><span class="o">(</span><span class="nc">String</span> <span class="n">sSrc</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">().</span><span class="na">decode</span><span class="o">(</span><span class="n">sSrc</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">AES128CBCStringEncoding</span><span class="o">(</span><span class="nc">String</span> <span class="n">encData</span> <span class="o">,</span><span class="nc">String</span> <span class="n">secretKey</span><span class="o">,</span><span class="nc">String</span> <span class="n">vector</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">secretKey</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">16</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">vector</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">vector</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">16</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nc">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"AES/CBC/PKCS5Padding"</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">raw</span> <span class="o">=</span> <span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
        <span class="nc">SecretKeySpec</span> <span class="n">skeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="n">raw</span><span class="o">,</span> <span class="s">"AES"</span><span class="o">);</span>
        <span class="nc">IvParameterSpec</span> <span class="n">iv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">(</span><span class="n">vector</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span><span class="c1">// ä½¿ç”¨CBCæ¨¡å¼ï¼Œéœ€è¦ä¸€ä¸ªå‘é‡ivï¼Œå¯å¢åŠ åŠ å¯†ç®—æ³•çš„å¼ºåº¦</span>
        <span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="nc">Cipher</span><span class="o">.</span><span class="na">ENCRYPT_MODE</span><span class="o">,</span> <span class="n">skeySpec</span><span class="o">,</span> <span class="n">iv</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">encData</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">));</span>

        <span class="k">return</span> <span class="n">encrypted</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">AES128CBCStringDecoding</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">sSrc</span><span class="o">,</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span><span class="nc">String</span> <span class="n">ivs</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">16</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">ivs</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ivs</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">16</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">raw</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"ASCII"</span><span class="o">);</span>
            <span class="nc">SecretKeySpec</span> <span class="n">skeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="n">raw</span><span class="o">,</span> <span class="s">"AES"</span><span class="o">);</span>
            <span class="nc">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"AES/CBC/PKCS5Padding"</span><span class="o">);</span>
            <span class="nc">IvParameterSpec</span> <span class="n">iv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">(</span><span class="n">ivs</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
            <span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="nc">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span> <span class="n">skeySpec</span><span class="o">,</span> <span class="n">iv</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">original</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">sSrc</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">originalString</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">original</span><span class="o">,</span> <span class="s">"utf-8"</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">originalString</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="c1">// åŠ å¯†</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">encrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">sSrc</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">encodeString</span><span class="o">=</span><span class="n">base64StringEncoding</span><span class="o">(</span><span class="nc">AES128CBCStringEncoding</span><span class="o">(</span><span class="n">sSrc</span><span class="o">,</span><span class="n">sKey</span><span class="o">,</span><span class="n">ivParameter</span><span class="o">),</span><span class="kc">false</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">encodeString</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// è§£å¯†</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">decrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">sSrc</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">decodeString</span><span class="o">=</span><span class="nc">AES128CBCStringDecoding</span><span class="o">(</span><span class="n">base64StringDecoding</span><span class="o">(</span><span class="n">sSrc</span><span class="o">),</span><span class="n">sKey</span><span class="o">,</span><span class="n">ivParameter</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">decodeString</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//test</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// éœ€è¦åŠ å¯†çš„å­—ä¸²</span>
        <span class="nc">String</span> <span class="n">cSrc</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>

        <span class="c1">// åŠ å¯†</span>
        <span class="kt">long</span> <span class="n">lStart</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">enString</span> <span class="o">=</span> <span class="nc">SecurityCore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">encrypt</span><span class="o">(</span><span class="n">cSrc</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"åŠ å¯†åçš„å­—ä¸²æ˜¯ï¼š"</span> <span class="o">+</span> <span class="n">enString</span><span class="o">);</span>

        <span class="kt">long</span> <span class="n">lUseTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">lStart</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"åŠ å¯†è€—æ—¶ï¼š"</span> <span class="o">+</span> <span class="n">lUseTime</span> <span class="o">+</span> <span class="s">"æ¯«ç§’"</span><span class="o">);</span>
        <span class="c1">// è§£å¯†</span>
        <span class="n">lStart</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">String</span> <span class="nc">DeString</span> <span class="o">=</span> <span class="nc">SecurityCore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">decrypt</span><span class="o">(</span><span class="n">enString</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è§£å¯†åçš„å­—ä¸²æ˜¯ï¼š"</span> <span class="o">+</span> <span class="nc">DeString</span><span class="o">);</span>
        <span class="n">lUseTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">lStart</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è§£å¯†è€—æ—¶ï¼š"</span> <span class="o">+</span> <span class="n">lUseTime</span> <span class="o">+</span> <span class="s">"æ¯«ç§’"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>##Golang</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>
<span class="k">import</span><span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"crypto/aes"</span>
    <span class="s">"crypto/cipher"</span>
    <span class="s">"encoding/base64"</span>
    <span class="s">"bytes"</span>
<span class="p">)</span>

<span class="k">const</span> <span class="p">(</span>
    <span class="n">sKey</span>        <span class="o">=</span> <span class="s">"dde4b1f8a9e6b814"</span>
    <span class="n">ivParameter</span>     <span class="o">=</span> <span class="s">"dde4b1f8a9e6b814"</span>
<span class="p">)</span>

<span class="o">/</span><span class="n">åŠ å¯†</span>
<span class="k">func</span> <span class="n">PswEncrypt</span><span class="p">(</span><span class="n">src</span> <span class="kt">string</span><span class="p">)(</span><span class="kt">string</span><span class="p">){</span>
    <span class="n">key</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="n">sKey</span><span class="p">)</span>
    <span class="n">iv</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="n">ivParameter</span><span class="p">)</span>

    <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">Aes128Encrypt</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span>  <span class="n">base64</span><span class="o">.</span><span class="n">RawStdEncoding</span><span class="o">.</span><span class="n">EncodeToString</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">//è§£å¯†</span>
<span class="k">func</span> <span class="n">PswDecrypt</span><span class="p">(</span><span class="n">src</span> <span class="kt">string</span><span class="p">)(</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">key</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="n">sKey</span><span class="p">)</span>
    <span class="n">iv</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="n">ivParameter</span><span class="p">)</span>

    <span class="k">var</span> <span class="n">result</span> <span class="p">[]</span><span class="kt">byte</span>
    <span class="k">var</span> <span class="n">err</span> <span class="kt">error</span>

    <span class="n">result</span><span class="p">,</span><span class="n">err</span><span class="o">=</span><span class="n">base64</span><span class="o">.</span><span class="n">RawStdEncoding</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">origData</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">Aes128Decrypt</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kt">string</span><span class="p">(</span><span class="n">origData</span><span class="p">)</span>

<span class="p">}</span>
<span class="k">func</span> <span class="n">Aes128Encrypt</span><span class="p">(</span><span class="n">origData</span><span class="p">,</span> <span class="n">key</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="n">IV</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="no">nil</span> <span class="o">||</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="m">16</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">IV</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">IV</span><span class="p">)</span> <span class="o">!=</span> <span class="m">16</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span>
    <span class="p">}</span>

    <span class="n">block</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">aes</span><span class="o">.</span><span class="n">NewCipher</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="n">blockSize</span> <span class="o">:=</span> <span class="n">block</span><span class="o">.</span><span class="n">BlockSize</span><span class="p">()</span>
    <span class="n">origData</span> <span class="o">=</span> <span class="n">PKCS5Padding</span><span class="p">(</span><span class="n">origData</span><span class="p">,</span> <span class="n">blockSize</span><span class="p">)</span>
    <span class="n">blockMode</span> <span class="o">:=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">NewCBCEncrypter</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">IV</span><span class="p">[</span><span class="o">:</span><span class="n">blockSize</span><span class="p">])</span>
    <span class="n">crypted</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">origData</span><span class="p">))</span>
    <span class="c">// æ ¹æ®CryptBlocksæ–¹æ³•çš„è¯´æ˜ï¼Œå¦‚ä¸‹æ–¹å¼åˆå§‹åŒ–cryptedä¹Ÿå¯ä»¥</span>
    <span class="n">blockMode</span><span class="o">.</span><span class="n">CryptBlocks</span><span class="p">(</span><span class="n">crypted</span><span class="p">,</span> <span class="n">origData</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crypted</span><span class="p">,</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Aes128Decrypt</span><span class="p">(</span><span class="n">crypted</span><span class="p">,</span> <span class="n">key</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="n">IV</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="no">nil</span> <span class="o">||</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="m">16</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">IV</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">IV</span><span class="p">)</span> <span class="o">!=</span> <span class="m">16</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span>
    <span class="p">}</span>

    <span class="n">block</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">aes</span><span class="o">.</span><span class="n">NewCipher</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="n">blockSize</span> <span class="o">:=</span> <span class="n">block</span><span class="o">.</span><span class="n">BlockSize</span><span class="p">()</span>
    <span class="n">blockMode</span> <span class="o">:=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">NewCBCDecrypter</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="n">IV</span><span class="p">[</span><span class="o">:</span><span class="n">blockSize</span><span class="p">])</span>
    <span class="n">origData</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">crypted</span><span class="p">))</span>
    <span class="n">blockMode</span><span class="o">.</span><span class="n">CryptBlocks</span><span class="p">(</span><span class="n">origData</span><span class="p">,</span> <span class="n">crypted</span><span class="p">)</span>
    <span class="n">origData</span> <span class="o">=</span> <span class="n">PKCS5UnPadding</span><span class="p">(</span><span class="n">origData</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">origData</span><span class="p">,</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">PKCS5Padding</span><span class="p">(</span><span class="n">ciphertext</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="n">blockSize</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
    <span class="n">padding</span> <span class="o">:=</span> <span class="n">blockSize</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span><span class="o">%</span><span class="n">blockSize</span>
    <span class="n">padtext</span> <span class="o">:=</span> <span class="n">bytes</span><span class="o">.</span><span class="n">Repeat</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="kt">byte</span><span class="p">(</span><span class="n">padding</span><span class="p">)},</span> <span class="n">padding</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">append</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">padtext</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">PKCS5UnPadding</span><span class="p">(</span><span class="n">origData</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
    <span class="n">length</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">origData</span><span class="p">)</span>
    <span class="c">// å»æ‰æœ€åä¸€ä¸ªå­—èŠ‚ unpadding æ¬¡</span>
    <span class="n">unpadding</span> <span class="o">:=</span> <span class="kt">int</span><span class="p">(</span><span class="n">origData</span><span class="p">[</span><span class="n">length</span><span class="o">-</span><span class="m">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">origData</span><span class="p">[</span><span class="o">:</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">unpadding</span><span class="p">)]</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">(){</span>
    <span class="n">encodingString</span> <span class="o">:=</span> <span class="n">PswEncrypt</span><span class="p">(</span><span class="s">"123"</span><span class="p">)</span>
    <span class="n">decodingString</span> <span class="o">:=</span> <span class="n">PswDecrypt</span><span class="p">(</span><span class="n">encodingString</span><span class="p">);</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"AES-128-CBC</span><span class="se">\n</span><span class="s">åŠ å¯†ï¼š%s</span><span class="se">\n</span><span class="s">è§£å¯†ï¼š%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">encodingString</span><span class="p">,</span><span class="n">decodingString</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

:ET
I"½$<h3 id="é”™è¯¯ç±»å‹">é”™è¯¯ç±»å‹</h3>

<ul>
  <li>å¼€å‘è¿‡ç¨‹å¸¸è§çš„é”™è¯¯
    <ul>
      <li>è¯­æ³•é”™è¯¯(ç¼–è¯‘æŠ¥é”™)</li>
      <li>é€»è¾‘é”™è¯¯</li>
      <li>è¿è¡Œæ—¶é”™è¯¯(å¯èƒ½ä¼šå¯¼è‡´é—ªé€€ï¼Œä¸€èˆ¬ä¹Ÿå«åšå¼‚å¸¸)</li>
      <li>â€¦â€¦</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="è‡ªå®šä¹‰é”™è¯¯">è‡ªå®šä¹‰é”™è¯¯</h3>

<ul>
  <li>Swiftä¸­å¯ä»¥é€šè¿‡<code class="language-plaintext highlighter-rouge">Error</code>åè®®è‡ªå®šä¹‰è¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>enum SomeError : Error {
    case illegalArg(String)
    case outOfBounds(Int, Int)
    case outOfMemory
}
</code></pre></div></div>

<ul>
  <li>å‡½æ•°å†…éƒ¨é€šè¿‡<code class="language-plaintext highlighter-rouge">throw</code>æŠ›å‡ºè‡ªå®šä¹‰<code class="language-plaintext highlighter-rouge">Error</code>ï¼Œå¯èƒ½ä¼šæŠ›å‡º<code class="language-plaintext highlighter-rouge">Error</code>çš„å‡½æ•°å¿…é¡»åŠ ä¸Š<code class="language-plaintext highlighter-rouge">throws</code>å£°æ˜</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func divide(_ num1: Int, _ num2: Int) throws -&gt; Int {
    if num2 == 0 {
        throw SomeError.illegalArg("0ä¸èƒ½ä½œä¸ºé™¤æ•°")
    }
    return num1 / num2
}
</code></pre></div></div>

<ul>
  <li>éœ€è¦ä½¿ç”¨tryè°ƒç”¨å¯èƒ½ä¼šæŠ›å‡ºErrorçš„å‡½æ•°</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var result = try divide(20, 10)
</code></pre></div></div>

<hr />

<h3 id="do-catch">do-catch</h3>

<ul>
  <li>å¯ä»¥ä½¿ç”¨do-catchæ•æ‰Error</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func test() {
    print("1")
    do {
        print("2")
        print(try divide(20, 0))
        print("3")
    } catch let SomeError.illegalArg(msg) {
        print("å‚æ•°å¼‚å¸¸:", msg)
    } catch let SomeError.outOfBounds(size, index) {
        print("ä¸‹æ ‡è¶Šç•Œ:", "size=\(size)", "index=\(index)")
    } catch SomeError.outOfMemory {
        print("å†…å­˜æº¢å‡º")
    } catch {
        print("å…¶ä»–é”™è¯¯")
    }
    print("4")
}
</code></pre></div></div>

<ul>
  <li>æŠ›å‡ºErroråï¼Œtryä¸‹ä¸€å¥ç›´åˆ°ä½œç”¨åŸŸç»“æŸçš„ä»£ç éƒ½å°†åœæ­¢è¿è¡Œ</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test()
// 1
// 2
// å‚æ•°å¼‚å¸¸: 0ä¸èƒ½ä½œä¸ºé™¤æ•°
// 4


do {
    try divide(20, 0)
} catch let error {
    switch error {
    case let SomeError.illegalArg(msg):
        print("å‚æ•°é”™è¯¯:", msg)
    default:
        print("å…¶ä»–é”™è¯¯")
    }
}
</code></pre></div></div>

<hr />

<h3 id="å¤„ç†error">å¤„ç†Error</h3>

<ul>
  <li>å¤„ç†<code class="language-plaintext highlighter-rouge">Error</code>çš„2ç§æ–¹å¼
    <ul>
      <li>é€šè¿‡<code class="language-plaintext highlighter-rouge">do-catch</code>æ•æ‰<code class="language-plaintext highlighter-rouge">Error</code></li>
      <li>ä¸æ•æ‰<code class="language-plaintext highlighter-rouge">Error</code>ï¼Œåœ¨å½“å‰å‡½æ•°å¢åŠ <code class="language-plaintext highlighter-rouge">throws</code>å£°æ˜ï¼Œ<code class="language-plaintext highlighter-rouge">Error</code>å°†è‡ªåŠ¨æŠ›ç»™ä¸Šå±‚å‡½æ•°
        <ul>
          <li>å¦‚æœæœ€é¡¶å±‚å‡½æ•°(mainå‡½æ•°)ä¾ç„¶æ²¡æœ‰æ•æ‰<code class="language-plaintext highlighter-rouge">Error</code>ï¼Œé‚£ä¹ˆç¨‹åºå°†ç»ˆæ­¢</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func test() throws {
    print("1")
    print(try divide(20, 0))
    print("2") }
try test()
// 1
// Fatal error: Error raised at top level

do {
    print(try divide(20, 0))
} catch is SomeError {
    print("SomeError")
}

func test() throws {
    print("1")
    do {
        print("2")
        print(try divide(20, 0))
        print("3")
    } catch let error as SomeError {
        print(error)
    }
    print("4") }
try test()
// 1
// 2
// illegalArg("0ä¸èƒ½ä½œä¸ºé™¤æ•°")
// 4
</code></pre></div></div>

<hr />

<h3 id="trytry">try?ã€try!</h3>

<ul>
  <li>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">try?ã€try!</code>è°ƒç”¨å¯èƒ½ä¼šæŠ›å‡º<code class="language-plaintext highlighter-rouge">Error</code>çš„å‡½æ•°ï¼Œè¿™æ ·å°±ä¸ç”¨å»å¤„ç†<code class="language-plaintext highlighter-rouge">Error</code></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func test() {
    print("1")
    var result1 = try? divide(20, 10) // Optional(2), Int?
    var result2 = try? divide(20, 0) // nil
    var result3 = try! divide(20, 10) // 2, Int
    print("2")
}
test()
</code></pre></div></div>

<ul>
  <li>aã€bæ˜¯ç­‰ä»·çš„</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var a = try? divide(20, 0)
var b: Int?
do {
    b = try divide(20, 0)
} catch { b = nil }
</code></pre></div></div>

<hr />

<h3 id="rethrows">rethrows</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">rethrows</code>è¡¨æ˜ : å‡½æ•°æœ¬èº«ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä½†è°ƒç”¨é—­åŒ…å‚æ•°æŠ›å‡ºé”™è¯¯ï¼Œé‚£ä¹ˆå®ƒä¼šå°†é”™è¯¯å‘ä¸ŠæŠ›</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func exec(_ fn: (Int, Int) throws -&gt; Int, _ num1: Int, _ num2: Int) rethrows { print(try fn(num1, num2))
}
// Fatal error: Error raised at top level
try exec(divide, 20, 0)
</code></pre></div></div>

<hr />

<h3 id="defer">defer</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">defer</code>è¯­å¥:ç”¨æ¥å®šä¹‰ä»¥ä»»ä½•æ–¹å¼(æŠ›é”™è¯¯ã€<code class="language-plaintext highlighter-rouge">return</code>ç­‰)ç¦»å¼€ä»£ç å—å‰å¿…é¡»è¦æ‰§è¡Œçš„ä»£ç 
    <ul>
      <li><code class="language-plaintext highlighter-rouge">defer</code>è¯­å¥å°†å»¶è¿Ÿè‡³å½“å‰ä½œç”¨åŸŸç»“æŸä¹‹å‰æ‰§è¡Œ</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func open(_ filename: String) -&gt; Int {
    print("open")
    return 0
}

func close(_ file: Int) {
    print("close")
}

func processFile(_ filename: String) throws {
    let file = open(filename)
    defer {
        close(file)
    }
    // ä½¿ç”¨file
    // ....
    try divide(20, 0)
    // closeå°†ä¼šåœ¨è¿™é‡Œè°ƒç”¨
}
try processFile("test.txt")
// open
// close
// Fatal error: Error raised at top level
</code></pre></div></div>

<ul>
  <li>deferè¯­å¥çš„æ‰§è¡Œé¡ºåºä¸å®šä¹‰é¡ºåºç›¸å</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func fn1() { print("fn1") }
func fn2() { print("fn2") }
func test() {
    defer { fn1() }
    defer { fn2() }
}
test()
// fn2
// fn1
</code></pre></div></div>

<hr />

<h3 id="assertæ–­è¨€">assert(æ–­è¨€)</h3>

<ul>
  <li>å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æœ‰æ–­è¨€æœºåˆ¶:ä¸ç¬¦åˆæŒ‡å®šæ¡ä»¶å°±æŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ï¼Œå¸¸ç”¨äºè°ƒè¯•(Debug)é˜¶æ®µçš„æ¡ä»¶åˆ¤æ–­</li>
  <li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSwiftçš„æ–­è¨€åªä¼šåœ¨Debugæ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼ŒReleaseæ¨¡å¼ä¸‹ä¼šå¿½ç•¥</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func divide(_ v1: Int, _ v2: Int) -&gt; Int {
    assert(v2 != 0, "é™¤æ•°ä¸èƒ½ä¸º0")
    return v1 / v2
}
print(divide(20, 0))
</code></pre></div></div>

<ul>
  <li>å¢åŠ Swift Flagsä¿®æ”¹æ–­è¨€çš„é»˜è®¤è¡Œä¸º
    <ul>
      <li>-assert-config Release:å¼ºåˆ¶å…³é—­æ–­è¨€</li>
      <li>-assert-config Debug:å¼ºåˆ¶å¼€å¯æ–­è¨€</li>
    </ul>
  </li>
</ul>

<p><img src="https://fuqionglin-blog.oss-cn-qingdao.aliyuncs.com/Swift5/000031.jpg" alt="" /></p>

<hr />

<h3 id="fatalerror">fatalError</h3>

<ul>
  <li>å¦‚æœé‡åˆ°ä¸¥é‡é—®é¢˜ï¼Œå¸Œæœ›ç»“æŸç¨‹åºè¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">fatalError</code>å‡½æ•°æŠ›å‡ºé”™è¯¯(è¿™æ˜¯æ— æ³•é€šè¿‡<code class="language-plaintext highlighter-rouge">do-catch</code>æ•æ‰çš„é”™è¯¯)
    <ul>
      <li>ä½¿ç”¨äº†<code class="language-plaintext highlighter-rouge">fatalError</code>å‡½æ•°ï¼Œå°±ä¸éœ€è¦å†å†™<code class="language-plaintext highlighter-rouge">return</code></li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func test(_ num: Int) -&gt; Int {
    if num &gt;= 0 {
        return 1
    }
    fatalError("numä¸èƒ½å°äº0")
}
</code></pre></div></div>

<ul>
  <li>åœ¨æŸäº›ä¸å¾—ä¸å®ç°ã€ä½†ä¸å¸Œæœ›åˆ«äººè°ƒç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘å†…éƒ¨ä½¿ç”¨fatalErrorå‡½æ•°</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Person { required init() {} }
class Student : Person {
    required init() { fatalError("don't call Student.init") }
    init(score: Int) {}
}
var stu1 = Student(score: 98)
var stu2 = Student()
</code></pre></div></div>

<hr />

<h3 id="å±€éƒ¨ä½œç”¨åŸŸ">å±€éƒ¨ä½œç”¨åŸŸ</h3>

<ul>
  <li>å¯ä»¥ä½¿ç”¨do å®ç°å±€éƒ¨ä½œç”¨åŸŸ</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>do {
    let dog1 = Dog()
    dog1.age = 10
    dog1.run()
}

do {
    let dog2 = Dog()
    dog2.age = 10
    dog2.run()
}
</code></pre></div></div>

:ET